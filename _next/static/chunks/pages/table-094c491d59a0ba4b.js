(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[460],{95877:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/table",function(){return a(16036)}])},16036:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>G});var l=a(74848),s=a(67888),i=a(87707),o=a(1574),n=a(62296),r=a(33779),c=a(94335),d=a(6761),u=a(2625),g=a(87500);let p=new d.E({defaultOptions:{queries:{staleTime:(0,u.T6)(1,"day","ms")}}});class h{async search(e,t,a){return(await p.fetchQuery({queryKey:["scs",e,t],queryFn:()=>(0,g.p)(()=>c.A.get(this.url,{signal:o.p.getSignal(),params:{ra:e,dec:t,sr:a},transformResponse:e=>{var t,a,l,s;let i=new DOMParser().parseFromString(e,"application/xml"),o=null===(t=i.querySelector('VOTABLE > RESOURCE > INFO[name="TableRows"]'))||void 0===t?void 0:t.getAttribute("value");if(o&&parseInt(o)>0){let e=i.querySelectorAll("VOTABLE > RESOURCE > TABLE > FIELD"),t=i.querySelector("VOTABLE > RESOURCE > TABLE > DATA > TABLEDATA > TR"),o=null==t?void 0:t.querySelectorAll("TD"),n={};for(let t=0;t<e.length;t++){let i=null===(a=e[t])||void 0===a?void 0:a.getAttribute("name"),r=null===(l=e[t])||void 0===l?void 0:l.getAttribute("datatype"),c=null==o?void 0:null===(s=o[t])||void 0===s?void 0:s.textContent;"float"===r||"double"===r?c=parseFloat(c):"int"===r&&(c=parseInt(c)),i&&(n[i]=c)}return n}}}))})).data}constructor(e){this.url=e}}var m=a(99907);let y=[0,8.5,9.5,10.5,11.5,12.5,13.5,14.5,15.5,16.5,17.5,18.5,19.5,100],f=[11.5,11.5,6,5.9,5.3,4.5,3.95,3.45,4.2,4.8,7.1,5.6,1.5,1.5],v=new d.E({defaultOptions:{queries:{staleTime:(0,u.T6)(1,"day","ms")}}});class b{async computePixscale(){let e=new h("https://bittersweet-large-ticket.glitch.me/https://datalab.noirlab.edu/scs/ls_dr10/tractor");try{let t=await e.search(this.ra,this.dec,1.5/3600),a=null==t?void 0:t.mag_r,l=null==t?void 0:t.shape_r;if(Number.isFinite(a)&&Number.isFinite(l)){let e=(0,m.A)(y,f,[a],"linear"),t=2*l*e[0]/this.size;return Math.max(Math.min(t,10),.12)}return}catch(e){console.log(e);return}}async fetch(){let e=this.pixscale;if(this.autoPixscale){let t=await this.computePixscale();void 0!=t&&null!=t&&(e=t)}return await v.fetchQuery({queryKey:[this.ra,this.dec,this.size,e,this.layer],queryFn:()=>(0,g.p)(()=>c.A.get("https://www.legacysurvey.org/viewer/cutout.jpg",{responseType:"blob",signal:o.p.getSignal(),params:{ra:this.ra,dec:this.dec,size:this.size,pixscale:e,layer:this.layer}}))})}constructor(e,t,a,l,s=!0,i="ls-dr10"){this.ra=e,this.dec=t,this.layer=i,this.pixscale=l,this.autoPixscale=s,this.size=a}}var w=a(21164);a(86454);let I=new d.E({defaultOptions:{queries:{staleTime:(0,u.T6)(12,"hour","ms")}}});o.p.create("splus-flux-radius",1);class C{getParams(){var e,t,a,l,s,i,o,n,r,c,d,u,g;return"trilogy"===this.type?{ra:this.ra,dec:this.dec,size:this.stampSize,r:null===(o=this.config)||void 0===o?void 0:null===(i=o.R)||void 0===i?void 0:i.join(","),g:null===(r=this.config)||void 0===r?void 0:null===(n=r.G)||void 0===n?void 0:n.join(","),b:null===(d=this.config)||void 0===d?void 0:null===(c=d.B)||void 0===c?void 0:c.join(","),noise:null===(u=this.config)||void 0===u?void 0:u.noise,q:null===(g=this.config)||void 0===g?void 0:g.Q}:{ra:this.ra,dec:this.dec,size:this.stampSize,r:null===(e=this.config)||void 0===e?void 0:e.R,g:null===(t=this.config)||void 0===t?void 0:t.G,b:null===(a=this.config)||void 0===a?void 0:a.B,stretch:null===(l=this.config)||void 0===l?void 0:l.stretch,q:null===(s=this.config)||void 0===s?void 0:s.Q}}getUrl(){return"trilogy"===this.type?"https://checker-melted-forsythia.glitch.me/trilogy.png":"https://checker-melted-forsythia.glitch.me/lupton.png"}async fetch(){return await I.fetchQuery({queryKey:[this.ra,this.dec,this.stampSize,this.type,this.config],queryFn:()=>(0,g.p)(()=>c.A.get(this.getUrl(),{responseType:"blob",signal:o.p.getSignal(),params:this.getParams()}))})}constructor(e,t,a,l,s){this.ra=e,this.dec=t,this.pixscale=a,this.type=l,this.config=s,this.stampSize=Math.min(Math.round(300*this.pixscale/.55),1e3)}}class E{async fetch(){return await I.fetchQuery({queryKey:[this.ra,this.dec,this.lines],queryFn:()=>(0,g.p)(()=>c.A.get("https://astrotools.vercel.app/plot",{responseType:"blob",signal:o.p.getSignal(),params:{ra:this.ra,dec:this.dec,...this.lines.reduce((e,t)=>(e[t]="",e),{})}}))})}constructor(e,t,a){this.ra=e,this.dec=t,this.lines=a}}var S=a(80346),x=a(66875),D=a(96540),A=a(69750),P=a(17965),_=a.n(P),T=a(97344),R=a(84684),q=a.n(R);S.syG.registerModules([S.JKr]),o.p.create("img:legacy",6),o.p.create("img:splus",5),o.p.create("img:splus_photospec",5),o.p.create("img:sdss_spec",4),o.p.create("sdss_cat",4);let z=async e=>{let{resourceFetch:t,colId:a,rowId:l,grid:s,isImage:i=!0}=e,o=s.api.getRowNode(l);if(((null==o?void 0:o.data[a])===n.Zm||(null==o?void 0:o.data[a])===void 0)&&(null==o?void 0:o.data.hasOwnProperty(a)))try{null==o||o.setDataValue(a,n.Ml);let e=await t.fetch();i?null==o||o.setDataValue(a,URL.createObjectURL(e.data)):null==o||o.setDataValue(a,e.data)}catch(e){null==o||o.setDataValue(a,n.AG)}},F=e=>{let{url:t,colId:a,rowId:l,grid:s}=e,i=s.api.getRowNode(l);if(((null==i?void 0:i.data[a])===n.Zm||(null==i?void 0:i.data[a])===void 0)&&(null==i?void 0:i.data.hasOwnProperty(a)))try{null==i||i.setDataValue(a,t)}catch(e){null==i||i.setDataValue(a,n.AG)}},k=[50,100,200,400,600,800,1e3],O={"--ag-cell-horizontal-padding":"8px","--ag-borders":"solid 1px","--ag-wrapper-border-radius":"0px","--ag-header-height":"38px"};function L(){let{tcState:e,tcDispatch:t}=(0,s.c4)(),a=(0,A.A)(),n=(0,D.useRef)(null),c=(0,T.E$)(),d=(0,D.useCallback)(a=>{var l,s;(!e.grid.api||(null===(s=e.grid)||void 0===s?void 0:null===(l=s.api)||void 0===l?void 0:l.isDestroyed))&&t({type:i.J.GRID_UPDATE,payload:{api:a.api}}),t({type:i.J.USER_FILE_INPUT,payload:{isSameFile:!0,state:"success"}})},[e,t]),u=(0,D.useCallback)(t=>{let a=t.api.paginationGetPageSize(),l=t.api.paginationGetCurrentPage(),s=[];t.api.forEachNodeAfterFilterAndSort(e=>{s.push(e.data)});let i=l*a,r=s.slice(i,i+a+400),c=e.table.columns[e.table.raIndex],d=e.table.columns[e.table.decIndex];o.p.clear(),r.forEach(t=>{let a=t["tab:".concat(c)],l=t["tab:".concat(d)],s=t["ai:id"];if(e.cols.legacyImaging.enabled&&o.p.enqueue("img:legacy",z,{resourceFetch:new b(a,l,300,e.cols.legacyImaging.pixelScale,e.cols.legacyImaging.autoPixelScale),colId:"img:legacy",rowId:s,grid:n.current}),e.cols.splusImaging.enabled){let t="trilogy"===e.cols.splusImaging.type?e.cols.splusImaging.trilogyConfig:e.cols.splusImaging.luptonConfig;o.p.enqueue("img:splus",z,{resourceFetch:new C(a,l,e.cols.splusImaging.pixelScale,e.cols.splusImaging.type,t),colId:"img:splus",rowId:s,grid:n.current})}e.cols.splusPhotoSpectra.enabled&&o.p.enqueue("img:splus_photospec",z,{resourceFetch:new E(a,l,e.cols.splusPhotoSpectra.selectedLines),colId:"img:splus_photospec",rowId:s,grid:n.current}),e.cols.sdssSpectra.enabled&&o.p.enqueue("img:sdss_spec",z,{resourceFetch:new w.mG(a,l),colId:"img:sdss_spec",rowId:s,grid:n.current,isImage:!1}),e.cols.customImaging.enabled&&e.cols.customImaging.columns.forEach((a,l,i)=>{let o="tab:".concat(e.table.columns[a.columnIndex]);F({url:"".concat(a.url).concat(t[o]||"").concat(a.fileExtension||""),colId:"img:custom_".concat(l),rowId:s,grid:n.current})}),e.cols.sdssCatalog.selectedColumns.forEach(e=>{o.p.enqueue("sdss_cat",z,{resourceFetch:new w.z2(a,l,e.table,e.column),colId:"sdss:".concat(e.table,"_").concat(e.column),rowId:s,grid:n.current,isImage:!1})})})},[e]),g=(0,D.useCallback)(t=>{let a=t.event;if(a){if("c"===a.key.toLowerCase()&&(a.ctrlKey||a.metaKey)&&!e.grid.editable)_()(t.value,{format:"text/plain",onCopy:()=>{null==c||c.show("Copied: ".concat(t.value),{autoHideDuration:2e3,severity:"success"})}});else if("x"===a.key.toLowerCase()&&(a.ctrlKey||a.metaKey)&&!e.grid.editable){if(e.table.raCol&&e.table.decCol){let a=t.data["tab:".concat(e.table.raCol)],l=t.data["tab:".concat(e.table.decCol)];_()("".concat(a," ").concat(l),{format:"text/plain",onCopy:()=>{null==c||c.show("Copied: ".concat(a," ").concat(l),{autoHideDuration:2e3,severity:"success"})}})}else null==c||c.show("Can not find RA and DEC columns",{autoHideDuration:2e3,severity:"error"})}else if(e.cols.classification.enabled&&!a.altKey&&!a.ctrlKey&&!a.shiftKey){for(let[s,i]of Object.entries(e.cols.classification.keyMap))if(i.toLowerCase()==a.key.toLowerCase()){var l;(null===(l=t.node.data)||void 0===l?void 0:l["ai:class"])==s?t.node.setDataValue("ai:class",void 0):t.node.setDataValue("ai:class",s)}}}},[e.cols.classification.enabled,e.cols.classification.keyMap]),p=(0,D.useCallback)(e=>e.data["ai:id"],[]),h={suppressHorizontalScroll:!1,multiSortKey:"ctrl"};(e.cols.splusImaging.enabled||e.cols.legacyImaging.enabled||e.cols.sdssSpectra.enabled||e.cols.splusPhotoSpectra.enabled||e.cols.customImaging.enabled&&e.cols.customImaging.columns.length>0)&&(h.rowHeight=parseInt(e.ui.figureSize));let m=(0,D.useCallback)(t=>{if(t.data){var a;return null===(a=e.plots.filterIndex)||void 0===a?void 0:a.includes(t.sourceRowIndex)}return!0},[e.plots.filterIndex]);(0,D.useEffect)(()=>{let{colDef:a,initVal:l}=r.A.getColDefs(e);t({type:i.J.GRID_UPDATE,payload:{colDef:a}})},[e.cols.classification.enabled,e.cols.splusPhotoSpectra.enabled,e.cols.legacyImaging.enabled,e.cols.splusImaging.enabled,e.table.selectedColumnsId,e.grid.editable,e.ui.figureSize,e.cols.sdssSpectra.enabled]),(0,D.useEffect)(()=>{var a,l;let{colDef:s,initVal:o}=r.A.getColDefs(e);(null===(a=e.grid)||void 0===a?void 0:a.data)&&(e.grid.data=null===(l=e.grid.data)||void 0===l?void 0:l.map(e=>q()(e,o))),t({type:i.J.GRID_UPDATE,payload:{colDef:s}})},[e.cols.sdssCatalog.enabled,e.cols.sdssCatalog.selectedColumns,e.cols.customImaging.enabled,e.cols.customImaging.columns]);let y=(0,D.useCallback)(t=>{console.log(e.grid.data)},[e.grid.data]),f=(0,D.useMemo)(()=>"light"==a.palette.mode?S.zl0.withPart(S.vXQ):S.zl0.withPart(S.T8J),[a.palette.mode]);return(0,l.jsx)("div",{className:"ag-theme-quartz",style:{width:"100%",height:"100%",...O},children:(0,l.jsx)(x.W6,{gridOptions:h,ref:n,rowData:e.grid.data||[],columnDefs:e.grid.colDef||[],getRowId:p,loading:"loading"===e.table.state,theme:f,pagination:!0,paginationPageSize:100,paginationPageSizeSelector:k,onGridReady:d,onPaginationChanged:u,onSortChanged:u,onFilterChanged:u,onCellKeyDown:g,onGridPreDestroyed:y,singleClickEdit:!0,isExternalFilterPresent:()=>e.plots.inspectSelected,doesExternalFilterPass:m})})}var K=a(76424);function G(){let{tcState:e}=(0,s.c4)(),t=(0,K.useRouter)();return(0,D.useEffect)(()=>{e.grid.data||t.push("/")},[]),(0,l.jsx)(L,{})}}},e=>{var t=t=>e(e.s=t);e.O(0,[108,649,636,593,792],()=>t(95877)),_N_E=e.O()}]);