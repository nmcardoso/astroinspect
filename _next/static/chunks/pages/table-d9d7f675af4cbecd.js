(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[460],{95877:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/table",function(){return s(85844)}])},85844:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>B});var a=s(74848),i=s(67888),l=s(87707),o=s(1574),r=s(62296),n=s(33779),c=s(2625);class d{async fetch(e){return{data:"".concat(this.prepend||"").concat(this.ri||"").concat(this.append||"")}}constructor(e,t,s){this.prepend=e,this.append=t,this.ri=s}}class u{async fetch(e){let t="".concat(this.prepend||"").concat(this.ri||"").concat(this.append||""),s=(0,c.ET)(t,this.folderStructure,this.filelist);if(s)return{data:s}}constructor(e,t,s,a,i){this.prepend=e,this.append=t,this.ri=s,this.filelist=i,this.folderStructure=a}}var p=s(94335),g=s(6761),h=s(87500);let m=new g.E({defaultOptions:{queries:{staleTime:(0,c.T6)(1,"day","ms")}}});class v{async search(e,t,s){return(await m.fetchQuery({queryKey:["scs",e,t],queryFn:()=>(0,h.p)(()=>p.A.get(this.url,{signal:o.p.getSignal(),params:{ra:e,dec:t,sr:s},transformResponse:e=>{var t,s,a,i;let l=new DOMParser().parseFromString(e,"application/xml"),o=null===(t=l.querySelector('VOTABLE > RESOURCE > INFO[name="TableRows"]'))||void 0===t?void 0:t.getAttribute("value");if(o&&parseInt(o)>0){let e=l.querySelectorAll("VOTABLE > RESOURCE > TABLE > FIELD"),t=l.querySelector("VOTABLE > RESOURCE > TABLE > DATA > TABLEDATA > TR"),o=null==t?void 0:t.querySelectorAll("TD"),r={};for(let t=0;t<e.length;t++){let l=null===(s=e[t])||void 0===s?void 0:s.getAttribute("name"),n=null===(a=e[t])||void 0===a?void 0:a.getAttribute("datatype"),c=null==o?void 0:null===(i=o[t])||void 0===i?void 0:i.textContent;"float"===n||"double"===n?c=parseFloat(c):"int"===n&&(c=parseInt(c)),l&&(r[l]=c)}return r}}}))})).data}constructor(e){this.url=e}}var y=s(99907);let f=["https://astrotools.vercel.app/legacy.jpg"],b=["https://astrotools.vercel.app/proxy/datalab.noirlab.edu/scs/ls_dr10/tractor"],I=[0,8.5,9.5,10.5,11.5,12.5,13.5,14.5,15.5,16.5,17.5,18.5,19.5,100],w=[11.5,11.5,6,5.9,5.3,4.5,3.95,3.45,4.2,4.8,7.1,5.6,1.5,1.5],S=new g.E({defaultOptions:{queries:{staleTime:(0,c.T6)(1,"day","ms"),retry:3,retryDelay:2e3}}});class C{async computePixscale(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new v((0,h.e)(b,e||0));try{let e=await t.search(this.ra,this.dec,1.5/3600),s=null==e?void 0:e.mag_r,a=null==e?void 0:e.shape_r;if(Number.isFinite(s)&&Number.isFinite(a)){let e=(0,y.A)(I,w,[s],"linear"),t=2*a*e[0]/this.size;return Math.max(Math.min(t,10),.12)}return}catch(e){console.log(e);return}}async fetch(e){let t=this.pixscale;if(this.autoPixscale){let s=await this.computePixscale(e.id);void 0!=s&&null!=s&&(t=s)}return await S.fetchQuery({queryKey:[this.ra,this.dec,this.size,t,this.layer],queryFn:()=>(0,h.p)(async()=>await p.A.get((0,h.e)(f,e.id||0),{responseType:"blob",signal:o.p.getSignal(),params:{ra:this.ra,dec:this.dec,size:this.size,pixscale:t,layer:this.layer}}))})}constructor(e,t,s,a,i=!0,l="ls-dr10"){this.ra=e,this.dec=t,this.layer=l,this.pixscale=a,this.autoPixscale=i,this.size=s}}var E=s(21164);s(86454);let x=["https://astrotools.vercel.app/trilogy.png"],D=["https://astrotools.vercel.app/lupton.png"],_=new g.E({defaultOptions:{queries:{staleTime:(0,c.T6)(12,"hour","ms")}}});o.p.create("splus-flux-radius",1);class P{getParams(){var e,t,s,a,i,l,o,r,n,c,d,u,p;return"trilogy"===this.type?{ra:this.ra,dec:this.dec,size:this.stampSize,r:null===(o=this.config)||void 0===o?void 0:null===(l=o.R)||void 0===l?void 0:l.join(","),g:null===(n=this.config)||void 0===n?void 0:null===(r=n.G)||void 0===r?void 0:r.join(","),b:null===(d=this.config)||void 0===d?void 0:null===(c=d.B)||void 0===c?void 0:c.join(","),noise:null===(u=this.config)||void 0===u?void 0:u.noise,q:null===(p=this.config)||void 0===p?void 0:p.Q}:{ra:this.ra,dec:this.dec,size:this.stampSize,r:null===(e=this.config)||void 0===e?void 0:e.R,g:null===(t=this.config)||void 0===t?void 0:t.G,b:null===(s=this.config)||void 0===s?void 0:s.B,stretch:null===(a=this.config)||void 0===a?void 0:a.stretch,q:null===(i=this.config)||void 0===i?void 0:i.Q}}getUrl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"trilogy"===this.type?(0,h.e)(x,e||0):(0,h.e)(D,e||0)}async fetch(e){return await _.fetchQuery({queryKey:[this.ra,this.dec,this.stampSize,this.type,this.config],queryFn:()=>(0,h.p)(()=>p.A.get(this.getUrl(e.id),{responseType:"blob",signal:o.p.getSignal(),params:this.getParams()}))})}constructor(e,t,s,a,i){this.ra=e,this.dec=t,this.pixscale=s,this.type=a,this.config=i,this.stampSize=Math.min(Math.round(300*this.pixscale/.55),1e3)}}class A{async fetch(e){return await _.fetchQuery({queryKey:[this.ra,this.dec,this.lines],queryFn:()=>(0,h.p)(()=>p.A.get("https://astrotools.vercel.app/plot",{responseType:"blob",signal:o.p.getSignal(),params:{ra:this.ra,dec:this.dec,...this.lines.reduce((e,t)=>(e[t]="",e),{})}}))})}constructor(e,t,s){this.ra=e,this.dec=t,this.lines=s}}var T=s(80346),q=s(66875),F=s(96540),R=s(69750),z=s(17965),O=s.n(z),k=s(97344),L=s(84684),K=s.n(L),G=s(72527);T.syG.registerModules([T.JKr]),o.p.create("img:legacy",6),o.p.create("img:splus",5),o.p.create("img:splus_photospec",5),o.p.create("img:sdss_spec",4),o.p.create("img:custom",15),o.p.create("sdss_cat",4),o.p.create("img:hips",5);let N=async e=>{let{resourceFetch:t,colId:s,rowId:a,grid:i,isImage:l=!0}=e,o=i.api.getRowNode(a);if(((null==o?void 0:o.data[s])===r.Zm||(null==o?void 0:o.data[s])===void 0)&&(null==o?void 0:o.data.hasOwnProperty(s)))try{null==o||o.setDataValue(s,r.Ml);let e=await t.fetch({id:parseInt(a)});l?null==o||o.setDataValue(s,URL.createObjectURL(e.data)):null==o||o.setDataValue(s,e.data)}catch(e){null==o||o.setDataValue(s,r.AG)}},U=[50,100,200,400,600,800,1e3],M={"--ag-cell-horizontal-padding":"8px","--ag-borders":"solid 1px","--ag-wrapper-border-radius":"0px","--ag-header-height":"38px"};function j(){let{tcState:e,tcDispatch:t}=(0,i.c4)(),s=(0,R.A)(),r=(0,F.useRef)(null),c=(0,k.E$)(),p=(0,F.useCallback)(s=>{var a,i;(!e.grid.api||(null===(i=e.grid)||void 0===i?void 0:null===(a=i.api)||void 0===a?void 0:a.isDestroyed))&&t({type:l.J.GRID_UPDATE,payload:{api:s.api}}),t({type:l.J.USER_FILE_INPUT,payload:{isSameFile:!0,state:"success"}})},[e,t]),g=(0,F.useCallback)(t=>{let s=t.api.paginationGetPageSize(),a=t.api.paginationGetCurrentPage(),i=[];t.api.forEachNodeAfterFilterAndSort(e=>{i.push(e.data)});let l=a*s,n=i.slice(l,l+s+400),c=e.table.columns[e.table.raIndex],p=e.table.columns[e.table.decIndex];o.p.clear(),n.forEach(t=>{let s=t["tab:".concat(c)],a=t["tab:".concat(p)],i=t["ai:id"];if(e.cols.legacyImaging.enabled&&o.p.enqueue("img:legacy",N,{resourceFetch:new C(s,a,300,e.cols.legacyImaging.pixelScale,e.cols.legacyImaging.autoPixelScale),colId:"img:legacy",rowId:i,grid:r.current}),e.cols.splusImaging.enabled){let t="trilogy"===e.cols.splusImaging.type?e.cols.splusImaging.trilogyConfig:e.cols.splusImaging.luptonConfig;o.p.enqueue("img:splus",N,{resourceFetch:new P(s,a,e.cols.splusImaging.pixelScale,e.cols.splusImaging.type,t),colId:"img:splus",rowId:i,grid:r.current})}if(e.cols.hipsImaging.enabled)for(let t of e.cols.hipsImaging.selectedSurveys){var l,n;let c=null!==(n=null===(l=e.cols.hipsImaging.surveySettings)||void 0===l?void 0:l[t])&&void 0!==n?n:e.cols.hipsImaging.defaultSettings;o.p.enqueue("img:hips",N,{resourceFetch:new G.SX(t,s,a,300,c.fov,c.minPixelCut,c.maxPixelCut,c.stretch,c.colormap,c.invert),colId:"img:hips_".concat(t),rowId:i,grid:r.current,isImage:!1})}e.cols.splusPhotoSpectra.enabled&&o.p.enqueue("img:splus_photospec",N,{resourceFetch:new A(s,a,e.cols.splusPhotoSpectra.selectedLines),colId:"img:splus_photospec",rowId:i,grid:r.current}),e.cols.sdssSpectra.enabled&&o.p.enqueue("img:sdss_spec",N,{resourceFetch:new E.mG(s,a),colId:"img:sdss_spec",rowId:i,grid:r.current,isImage:!1}),e.cols.customImaging.enabled&&e.cols.customImaging.columns.forEach((s,a,l)=>{let n="tab:".concat(e.table.columns[s.columnIndex]);if("url"===s.type)o.p.enqueue("img:custom",N,{resourceFetch:new d(s.prepend,s.append,t[n]),colId:"img:custom_".concat(a),rowId:i,grid:r.current,isImage:!1});else if("folder"===s.type){var c,p,g,h;o.p.enqueue("img:custom",N,{resourceFetch:new u(s.prepend,s.append,t[n],null===(p=e.cols.customImaging.columns)||void 0===p?void 0:null===(c=p[a])||void 0===c?void 0:c.folderStructure,null===(h=e.cols.customImaging.columns)||void 0===h?void 0:null===(g=h[a])||void 0===g?void 0:g.folder),colId:"img:custom_".concat(a),rowId:i,grid:r.current,isImage:!0})}}),e.cols.sdssCatalog.selectedColumns.forEach(e=>{o.p.enqueue("sdss_cat",N,{resourceFetch:new E.z2(s,a,e.table,e.column),colId:"sdss:".concat(e.table,"_").concat(e.column),rowId:i,grid:r.current,isImage:!1})})})},[e]),h=(0,F.useCallback)(t=>{let s=t.event;if(s){if("c"===s.key.toLowerCase()&&(s.ctrlKey||s.metaKey)&&!e.grid.editable)O()(t.value,{format:"text/plain",onCopy:()=>{null==c||c.show("Copied: ".concat(t.value),{autoHideDuration:2e3,severity:"success"})}});else if("x"===s.key.toLowerCase()&&(s.ctrlKey||s.metaKey)&&!e.grid.editable){if(e.table.raCol&&e.table.decCol){let s=t.data["tab:".concat(e.table.raCol)],a=t.data["tab:".concat(e.table.decCol)];O()("".concat(s," ").concat(a),{format:"text/plain",onCopy:()=>{null==c||c.show("Copied: ".concat(s," ").concat(a),{autoHideDuration:2e3,severity:"success"})}})}else null==c||c.show("Can not find RA and DEC columns",{autoHideDuration:2e3,severity:"error"})}else if(e.cols.classification.enabled&&!s.altKey&&!s.ctrlKey&&!s.shiftKey){for(let[i,l]of Object.entries(e.cols.classification.keyMap))if(l.toLowerCase()==s.key.toLowerCase()){var a;(null===(a=t.node.data)||void 0===a?void 0:a["ai:class"])==i?t.node.setDataValue("ai:class",void 0):t.node.setDataValue("ai:class",i)}}}},[e.cols.classification.enabled,e.cols.classification.keyMap]),m=(0,F.useCallback)(e=>e.data["ai:id"],[]),v={suppressHorizontalScroll:!1,multiSortKey:"ctrl"};(e.cols.splusImaging.enabled||e.cols.legacyImaging.enabled||e.cols.sdssSpectra.enabled||e.cols.splusPhotoSpectra.enabled||e.cols.hipsImaging.enabled||e.cols.customImaging.enabled&&e.cols.customImaging.columns.length>0)&&(v.rowHeight=parseInt(e.ui.figureSize));let y=(0,F.useCallback)(t=>{if(t.data){var s;return null===(s=e.plots.filterIndex)||void 0===s?void 0:s.includes(t.sourceRowIndex)}return!0},[e.plots.filterIndex]);(0,F.useEffect)(()=>{let{colDef:s,initVal:a}=n.A.getColDefs(e);t({type:l.J.GRID_UPDATE,payload:{colDef:s}})},[e.cols.classification.enabled,e.cols.splusPhotoSpectra.enabled,e.cols.legacyImaging.enabled,e.cols.splusImaging.enabled,e.table.selectedColumnsId,e.grid.editable,e.ui.figureSize,e.cols.sdssSpectra.enabled,e.cols.hipsImaging.enabled]),(0,F.useEffect)(()=>{var s,a;let{colDef:i,initVal:o}=n.A.getColDefs(e);(null===(s=e.grid)||void 0===s?void 0:s.data)&&(e.grid.data=null===(a=e.grid.data)||void 0===a?void 0:a.map(e=>K()(e,o))),t({type:l.J.GRID_UPDATE,payload:{colDef:i}})},[e.cols.sdssCatalog.enabled,e.cols.sdssCatalog.selectedColumns,e.cols.customImaging.enabled,e.cols.customImaging.columns,e.cols.hipsImaging.enabled,e.cols.hipsImaging.selectedSurveys]);let f=(0,F.useCallback)(t=>{console.log(e.grid.data)},[e.grid.data]),b=(0,F.useMemo)(()=>"light"==s.palette.mode?T.zl0.withPart(T.vXQ):T.zl0.withPart(T.T8J),[s.palette.mode]);return(0,a.jsx)("div",{className:"ag-theme-quartz",style:{width:"100%",height:"100%",...M},children:(0,a.jsx)(q.W6,{gridOptions:v,ref:r,rowData:e.grid.data||[],columnDefs:e.grid.colDef||[],getRowId:m,loading:"loading"===e.table.state,theme:b,pagination:!0,paginationPageSize:100,paginationPageSizeSelector:U,onGridReady:p,onPaginationChanged:g,onSortChanged:g,onFilterChanged:g,onCellKeyDown:h,onGridPreDestroyed:f,singleClickEdit:!0,isExternalFilterPresent:()=>e.plots.inspectSelected,doesExternalFilterPass:y})})}var V=s(76424);function B(){let{tcState:e}=(0,i.c4)(),t=(0,V.useRouter)();return(0,F.useEffect)(()=>{e.grid.data||t.push("/")},[]),(0,a.jsx)(j,{})}}},e=>{var t=t=>e(e.s=t);e.O(0,[108,649,636,593,792],()=>t(95877)),_N_E=e.O()}]);