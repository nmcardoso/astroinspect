(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[460],{95877:(e,t,l)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/table",function(){return l(85844)}])},85844:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>en});var s=l(74848),a=l(67888),i=l(87707),o=l(1574),n=l(62296),c=l(33779),r=l(2625);class d{async fetch(e){return{data:"".concat(this.prepend||"").concat(this.ri||"").concat(this.append||"")}}constructor(e,t,l){this.prepend=e,this.append=t,this.ri=l}}class u{async fetch(e){let t="".concat(this.prepend||"").concat(this.ri||"").concat(this.append||""),l=(0,r.ET)(t,this.folderStructure,this.filelist);if(l)return{data:l}}constructor(e,t,l,s,a){this.prepend=e,this.append=t,this.ri=l,this.filelist=a,this.folderStructure=s}}var p=l(94335),g=l(6761),h=l(87500);let m=new g.E({defaultOptions:{queries:{staleTime:(0,r.T6)(1,"day","ms")}}});class v{async search(e,t,l){return(await m.fetchQuery({queryKey:["scs",e,t],queryFn:()=>(0,h.p)(()=>p.A.get(this.url,{signal:o.p.getSignal(),params:{ra:e,dec:t,sr:l},transformResponse:e=>{var t,l,s,a;let i=new DOMParser().parseFromString(e,"application/xml"),o=null===(t=i.querySelector('VOTABLE > RESOURCE > INFO[name="TableRows"]'))||void 0===t?void 0:t.getAttribute("value");if(o&&parseInt(o)>0){let e=i.querySelectorAll("VOTABLE > RESOURCE > TABLE > FIELD"),t=i.querySelector("VOTABLE > RESOURCE > TABLE > DATA > TABLEDATA > TR"),o=null==t?void 0:t.querySelectorAll("TD"),n={};for(let t=0;t<e.length;t++){let i=null===(l=e[t])||void 0===l?void 0:l.getAttribute("name"),c=null===(s=e[t])||void 0===s?void 0:s.getAttribute("datatype"),r=null==o?void 0:null===(a=o[t])||void 0===a?void 0:a.textContent;"float"===c||"double"===c?r=parseFloat(r):"int"===c&&(r=parseInt(r)),i&&(n[i]=r)}return n}}}))})).data}constructor(e){this.url=e}}var y=l(99907);let f=["https://astrotools.vercel.app/legacy.jpg"],b=["https://astrotools.vercel.app/proxy/datalab.noirlab.edu/scs/ls_dr10/tractor"],x=[0,8.5,9.5,10.5,11.5,12.5,13.5,14.5,15.5,16.5,17.5,18.5,19.5,100],C=[11.5,11.5,6,5.9,5.3,4.5,3.95,3.45,4.2,4.8,7.1,5.6,1.5,1.5],I=new g.E({defaultOptions:{queries:{staleTime:(0,r.T6)(1,"day","ms"),retry:3,retryDelay:2e3}}});class S{async computePixscale(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=new v((0,h.e)(b,e||0));try{let e=await t.search(this.ra,this.dec,1.5/3600),l=null==e?void 0:e.mag_r,s=null==e?void 0:e.shape_r;if(Number.isFinite(l)&&Number.isFinite(s)){let e=(0,y.A)(x,C,[l],"linear"),t=2*s*e[0]/this.size;return Math.max(Math.min(t,10),.12)}return}catch(e){console.log(e);return}}async fetch(e){let t=this.pixscale;if(this.autoPixscale){let l=await this.computePixscale(e.id);void 0!=l&&null!=l&&(t=l)}return await I.fetchQuery({queryKey:[this.ra,this.dec,this.size,t,this.layer],queryFn:()=>(0,h.p)(async()=>await p.A.get((0,h.e)(f,e.id||0),{responseType:"blob",signal:o.p.getSignal(),params:{ra:this.ra,dec:this.dec,size:this.size,pixscale:t,layer:this.layer}}))})}constructor(e,t,l,s,a=!0,i="ls-dr10"){this.ra=e,this.dec=t,this.layer=i,this.pixscale=s,this.autoPixscale=a,this.size=l}}var w=l(21164);l(86454);let A=["https://astrotools.vercel.app/trilogy.png"],E=["https://astrotools.vercel.app/lupton.png"],_=new g.E({defaultOptions:{queries:{staleTime:(0,r.T6)(12,"hour","ms")}}});o.p.create("splus-flux-radius",1);class D{getParams(){var e,t,l,s,a,i,o,n,c,r,d,u,p;return"trilogy"===this.type?{ra:this.ra,dec:this.dec,size:this.stampSize,r:null===(o=this.config)||void 0===o?void 0:null===(i=o.R)||void 0===i?void 0:i.join(","),g:null===(c=this.config)||void 0===c?void 0:null===(n=c.G)||void 0===n?void 0:n.join(","),b:null===(d=this.config)||void 0===d?void 0:null===(r=d.B)||void 0===r?void 0:r.join(","),noise:null===(u=this.config)||void 0===u?void 0:u.noise,q:null===(p=this.config)||void 0===p?void 0:p.Q}:{ra:this.ra,dec:this.dec,size:this.stampSize,r:null===(e=this.config)||void 0===e?void 0:e.R,g:null===(t=this.config)||void 0===t?void 0:t.G,b:null===(l=this.config)||void 0===l?void 0:l.B,stretch:null===(s=this.config)||void 0===s?void 0:s.stretch,q:null===(a=this.config)||void 0===a?void 0:a.Q}}getUrl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"trilogy"===this.type?(0,h.e)(A,e||0):(0,h.e)(E,e||0)}async fetch(e){return await _.fetchQuery({queryKey:[this.ra,this.dec,this.stampSize,this.type,this.config],queryFn:()=>(0,h.p)(()=>p.A.get(this.getUrl(e.id),{responseType:"blob",signal:o.p.getSignal(),params:this.getParams()}))})}constructor(e,t,l,s,a){this.ra=e,this.dec=t,this.pixscale=l,this.type=s,this.config=a,this.stampSize=Math.min(Math.round(300*this.pixscale/.55),1e3)}}class P{async fetch(e){return await _.fetchQuery({queryKey:[this.ra,this.dec,this.lines],queryFn:()=>(0,h.p)(()=>p.A.get("https://astrotools.vercel.app/plot",{responseType:"blob",signal:o.p.getSignal(),params:{ra:this.ra,dec:this.dec,...this.lines.reduce((e,t)=>(e[t]="",e),{})}}))})}constructor(e,t,l){this.ra=e,this.dec=t,this.lines=l}}var j=l(80346),T=l(66875),q=l(96540),R=l(93595),F=l(23445),z=l(94704),k=l(64204),O=l(73680),L=l(59202),N=l(69750),K=l(73708),U=l(46698),G=l(17965),M=l.n(G),V=l(97344),B=l(84684),J=l.n(B),Q=l(72527),X=l(71460),H=l(40995),W=l(98545);j.syG.registerModules([j.JKr]),o.p.create("img:legacy",6),o.p.create("img:splus",5),o.p.create("img:splus_photospec",5),o.p.create("img:sdss_spec",4),o.p.create("img:custom",15),o.p.create("sdss_cat",4),o.p.create("img:hips",5);let Z=[50,100,200,400,600,800,1e3],$={"--ag-cell-horizontal-padding":"8px","--ag-borders":"solid 1px","--ag-wrapper-border-radius":"0px","--ag-header-height":"38px"},Y=async e=>{let{resourceFetch:t,colId:l,rowId:s,grid:a,isImage:i=!0}=e,o=a.api.getRowNode(s);if(((null==o?void 0:o.data[l])===n.Zm||(null==o?void 0:o.data[l])===void 0)&&(null==o?void 0:o.data.hasOwnProperty(l)))try{null==o||o.setDataValue(l,n.Ml);let e=await t.fetch({id:parseInt(s)});i?null==o||o.setDataValue(l,URL.createObjectURL(e.data)):null==o||o.setDataValue(l,e.data)}catch(e){null==o||o.setDataValue(l,n.AG)}},ee=(e,t)=>{M()(e,{format:"text/plain",onCopy:()=>{null==t||t.show("Copied: ".concat(e),{autoHideDuration:2e3,severity:"success"})}})},et=(e,t,l)=>{if(l.table.raCol&&l.table.decCol){let s=e["tab:".concat(l.table.raCol)],a=e["tab:".concat(l.table.decCol)];M()("".concat(s," ").concat(a),{format:"text/plain",onCopy:()=>{null==t||t.show("Copied: ".concat(s," ").concat(a),{autoHideDuration:2e3,severity:"success"})}})}else null==t||t.show("Can not find RA and DEC columns",{autoHideDuration:2e3,severity:"error"})},el=(e,t)=>{var l;let s=String(e["tab:".concat(t.table.raCol)]),a=String(e["tab:".concat(t.table.decCol)]);a.startsWith("-")||(a="+"+a);let i="https://simbad.u-strasbg.fr/simbad/sim-coo?Coord=".concat(s).concat(a)+"&CooFrame=FK5&CooEpoch=2000&CooEqui=2000&CooDefinedFrames=none&Radius=5&Radius.unit=arcsec&submit=submit+query&CoordList=";null===(l=window.open(i,"_blank"))||void 0===l||l.focus()},es=(e,t)=>{var l;let s=String(e["tab:".concat(t.table.raCol)]),a=String(e["tab:".concat(t.table.decCol)]);a.startsWith("-")||(a="+"+a);let i="https://ned.ipac.caltech.edu/conesearch?search_type=Near%20Position%20Search"+"&in_csys=Equatorial&in_equinox=J2000&ra=".concat(s,"d&dec=").concat(a,"d")+"&radius=0.083&Z_CONSTRAINT=Unconstrained";null===(l=window.open(i,"_blank"))||void 0===l||l.focus()};function ea(e){let{context:t,onClose:l=()=>{}}=e,{tcState:i,tcDispatch:o}=(0,a.c4)(),n=(0,V.E$)();return(0,s.jsx)(R.Ay,{open:null!==t,onClose:l,anchorReference:"anchorPosition",anchorPosition:null!==t?{top:(null==t?void 0:t.event).clientY-6,left:(null==t?void 0:t.event).clientX+2}:void 0,children:(0,s.jsx)(F.A,{sx:{width:260,maxWidth:"100%"},children:(0,s.jsxs)(z.A,{children:[(0,s.jsxs)(K.A,{onClick:()=>{ee(null==t?void 0:t.value,n),l()},children:[(0,s.jsx)(k.A,{children:(0,s.jsx)(X.A,{fontSize:"small"})}),(0,s.jsx)(O.A,{children:"Copy"}),(0,s.jsx)(L.A,{variant:"body2",sx:{color:"text.secondary"},children:"Ctrl + C"})]}),(0,s.jsxs)(K.A,{onClick:()=>{et(null==t?void 0:t.data,n,i),l()},children:[(0,s.jsx)(k.A,{children:(0,s.jsx)(H.A,{fontSize:"small"})}),(0,s.jsx)(O.A,{children:"Copy position"}),(0,s.jsx)(L.A,{variant:"body2",sx:{color:"text.secondary"},children:"Ctrl + X"})]}),(0,s.jsx)(U.A,{sx:{my:.5}}),(0,s.jsxs)(K.A,{onClick:()=>{el(null==t?void 0:t.data,i),l()},children:[(0,s.jsx)(k.A,{children:(0,s.jsx)(W.A,{fontSize:"small"})}),(0,s.jsx)(O.A,{children:"Search Simbad"})]}),(0,s.jsxs)(K.A,{onClick:()=>{es(null==t?void 0:t.data,i),l()},children:[(0,s.jsx)(k.A,{children:(0,s.jsx)(W.A,{fontSize:"small"})}),(0,s.jsx)(O.A,{children:"Search NED"})]})]})})})}function ei(){let{tcState:e,tcDispatch:t}=(0,a.c4)(),l=(0,N.A)(),n=(0,q.useRef)(null),r=(0,V.E$)(),[p,g]=(0,q.useState)(null),h=(0,q.useCallback)(l=>{var s,a;(!e.grid.api||(null===(a=e.grid)||void 0===a?void 0:null===(s=a.api)||void 0===s?void 0:s.isDestroyed))&&t({type:i.J.GRID_UPDATE,payload:{api:l.api}}),t({type:i.J.USER_FILE_INPUT,payload:{isSameFile:!0,state:"success"}})},[e,t]),m=(0,q.useCallback)(t=>{let l=t.api.paginationGetPageSize(),s=t.api.paginationGetCurrentPage(),a=[];t.api.forEachNodeAfterFilterAndSort(e=>{a.push(e.data)});let i=s*l,c=a.slice(i,i+l+400),r=e.table.columns[e.table.raIndex],p=e.table.columns[e.table.decIndex];o.p.clear(),c.forEach(t=>{let l=t["tab:".concat(r)],s=t["tab:".concat(p)],a=t["ai:id"];if(e.cols.legacyImaging.enabled&&o.p.enqueue("img:legacy",Y,{resourceFetch:new S(l,s,300,e.cols.legacyImaging.pixelScale,e.cols.legacyImaging.autoPixelScale),colId:"img:legacy",rowId:a,grid:n.current}),e.cols.splusImaging.enabled){let t="trilogy"===e.cols.splusImaging.type?e.cols.splusImaging.trilogyConfig:e.cols.splusImaging.luptonConfig;o.p.enqueue("img:splus",Y,{resourceFetch:new D(l,s,e.cols.splusImaging.pixelScale,e.cols.splusImaging.type,t),colId:"img:splus",rowId:a,grid:n.current})}if(e.cols.hipsImaging.enabled)for(let t of e.cols.hipsImaging.selectedSurveys){var i,c;let r=null!==(c=null===(i=e.cols.hipsImaging.surveySettings)||void 0===i?void 0:i[t])&&void 0!==c?c:e.cols.hipsImaging.defaultSettings;o.p.enqueue("img:hips",Y,{resourceFetch:new Q.SX(t,l,s,300,r.fov,r.minPixelCut,r.maxPixelCut,r.stretch,r.colormap,r.invert),colId:"img:hips_".concat(t),rowId:a,grid:n.current,isImage:!1})}e.cols.splusPhotoSpectra.enabled&&o.p.enqueue("img:splus_photospec",Y,{resourceFetch:new P(l,s,e.cols.splusPhotoSpectra.selectedLines),colId:"img:splus_photospec",rowId:a,grid:n.current}),e.cols.sdssSpectra.enabled&&o.p.enqueue("img:sdss_spec",Y,{resourceFetch:new w.mG(l,s),colId:"img:sdss_spec",rowId:a,grid:n.current,isImage:!1}),e.cols.customImaging.enabled&&e.cols.customImaging.columns.forEach((l,s,i)=>{let c="tab:".concat(e.table.columns[l.columnIndex]);if("url"===l.type)o.p.enqueue("img:custom",Y,{resourceFetch:new d(l.prepend,l.append,t[c]),colId:"img:custom_".concat(s),rowId:a,grid:n.current,isImage:!1});else if("folder"===l.type){var r,p,g,h;o.p.enqueue("img:custom",Y,{resourceFetch:new u(l.prepend,l.append,t[c],null===(p=e.cols.customImaging.columns)||void 0===p?void 0:null===(r=p[s])||void 0===r?void 0:r.folderStructure,null===(h=e.cols.customImaging.columns)||void 0===h?void 0:null===(g=h[s])||void 0===g?void 0:g.folder),colId:"img:custom_".concat(s),rowId:a,grid:n.current,isImage:!0})}}),e.cols.sdssCatalog.selectedColumns.forEach(e=>{o.p.enqueue("sdss_cat",Y,{resourceFetch:new w.z2(l,s,e.table,e.column),colId:"sdss:".concat(e.table,"_").concat(e.column),rowId:a,grid:n.current,isImage:!1})})})},[e]),v=(0,q.useCallback)(t=>{let l=t.event;if(l){if("c"===l.key.toLowerCase()&&(l.ctrlKey||l.metaKey)&&!e.grid.editable)ee(null==t?void 0:t.value,r);else if("x"===l.key.toLowerCase()&&(l.ctrlKey||l.metaKey)&&!e.grid.editable)et(null==t?void 0:t.data,r,e);else if(e.cols.classification.enabled&&!l.altKey&&!l.ctrlKey&&!l.shiftKey){for(let[a,i]of Object.entries(e.cols.classification.keyMap))if(i.toLowerCase()==l.key.toLowerCase()){var s;(null===(s=t.node.data)||void 0===s?void 0:s["ai:class"])==a?t.node.setDataValue("ai:class",void 0):t.node.setDataValue("ai:class",a)}}}},[e.cols.classification.enabled,e.cols.classification.keyMap]),y=(0,q.useCallback)(e=>e.data["ai:id"],[]),f={suppressHorizontalScroll:!1,multiSortKey:"ctrl"};(e.cols.splusImaging.enabled||e.cols.legacyImaging.enabled||e.cols.sdssSpectra.enabled||e.cols.splusPhotoSpectra.enabled||e.cols.hipsImaging.enabled||e.cols.customImaging.enabled&&e.cols.customImaging.columns.length>0)&&(f.rowHeight=parseInt(e.ui.figureSize));let b=(0,q.useCallback)(t=>{if(t.data){var l;return null===(l=e.plots.filterIndex)||void 0===l?void 0:l.includes(t.sourceRowIndex)}return!0},[e.plots.filterIndex]);(0,q.useEffect)(()=>{let{colDef:l,initVal:s}=c.A.getColDefs(e);t({type:i.J.GRID_UPDATE,payload:{colDef:l}})},[e.cols.classification.enabled,e.cols.splusPhotoSpectra.enabled,e.cols.legacyImaging.enabled,e.cols.splusImaging.enabled,e.table.selectedColumnsId,e.grid.editable,e.ui.figureSize,e.cols.sdssSpectra.enabled,e.cols.hipsImaging.enabled]),(0,q.useEffect)(()=>{var l,s;let{colDef:a,initVal:o}=c.A.getColDefs(e);(null===(l=e.grid)||void 0===l?void 0:l.data)&&(e.grid.data=null===(s=e.grid.data)||void 0===s?void 0:s.map(e=>J()(e,o))),t({type:i.J.GRID_UPDATE,payload:{colDef:a}})},[e.cols.sdssCatalog.enabled,e.cols.sdssCatalog.selectedColumns,e.cols.customImaging.enabled,e.cols.customImaging.columns,e.cols.hipsImaging.enabled,e.cols.hipsImaging.selectedSurveys]);let x=(0,q.useCallback)(t=>{console.log(e.grid.data)},[e.grid.data]),C=(0,q.useMemo)(()=>"light"==l.palette.mode?j.zl0.withPart(j.vXQ):j.zl0.withPart(j.T8J),[l.palette.mode]);return(0,s.jsxs)("div",{className:"ag-theme-quartz",style:{width:"100%",height:"100%",...$},onContextMenu:e=>e.preventDefault(),children:[(0,s.jsx)(T.W6,{gridOptions:f,ref:n,rowData:e.grid.data||[],columnDefs:e.grid.colDef||[],getRowId:y,loading:"loading"===e.table.state,theme:C,pagination:!0,paginationPageSize:100,paginationPageSizeSelector:Z,onGridReady:h,onPaginationChanged:m,onSortChanged:m,onFilterChanged:m,onCellKeyDown:v,onGridPreDestroyed:x,singleClickEdit:!0,isExternalFilterPresent:()=>e.plots.inspectSelected,doesExternalFilterPass:b,onCellContextMenu:e=>{var t;null===(t=e.event)||void 0===t||t.preventDefault(),g(null===p?e:null);let l=document.getSelection();if(l&&l.rangeCount>0){let e=l.getRangeAt(0);setTimeout(()=>{l.addRange(e)})}}}),(0,s.jsx)(ea,{context:p,onClose:()=>{g(null)}})]})}var eo=l(76424);function en(){let{tcState:e}=(0,a.c4)(),t=(0,eo.useRouter)();return(0,q.useEffect)(()=>{e.grid.data||t.push("/")},[]),(0,s.jsx)(ei,{})}}},e=>{var t=t=>e(e.s=t);e.O(0,[108,488,636,593,792],()=>t(95877)),_N_E=e.O()}]);