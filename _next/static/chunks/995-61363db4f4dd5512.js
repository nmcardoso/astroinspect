(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[995],{15207:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=15207,e.exports=t},45837:(e,t,l)=>{"use strict";l.d(t,{A:()=>Q});var a=l(74848),n=l(22761),i=l(67888),o=l(87707),r=l(96540),s=l(36175),d=l(52177),c=l(41169),u=l(60686),p=l(23445),m=l(59202),x=l(67105);function h(e){let{filename:t,width:l,inputRef:n,onChange:i,sx:o}=e,[s,d]=(0,r.useState)(void 0);t=t||s;let c=(0,r.useRef)(null);return n||(n=c),(0,a.jsxs)(p.A,{variant:"outlined",className:"cursor-pointer",onClick:()=>{var e;null===(e=n.current)||void 0===e||e.click()},sx:{width:l,px:2,py:1.5,display:"flex",flexDirection:"row",borderColor:"action.disabled",justifyContent:"space-between",alignItems:"center",...o},children:[(0,a.jsx)("input",{hidden:!0,type:"file",ref:n,style:{display:"none"},onChange:e=>{var t;d(null===(t=e.target.files)||void 0===t?void 0:t[0].name),i(e)}}),(0,a.jsx)(m.A,{sx:{textOverflow:"ellipsis"},children:t||(0,a.jsx)("i",{children:"No file selected"})}),(0,a.jsx)(u.A,{startIcon:(0,a.jsx)(x.A,{}),variant:"contained",children:"Upload"})]})}var v=l(13210);function f(){var e;let{tcState:t,tcDispatch:l}=(0,i.c4)(),u=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(t.table.file&&u.current){let e=new DataTransfer;e.items.add(t.table.file);let l=e.files;u.current.files=l}},[t.table.file]);let p=(0,r.useCallback)(e=>{if(e.target.files.length>0){var a;let n=e.target.files[0];l({type:o.J.USER_FILE_INPUT,payload:{state:"loading"}}),null===(a=(0,s.E)(n))||void 0===a||a.getTableSummary().then(e=>{if(console.log("summary",e),void 0!==e){var a,i,r;let s="local"===t.table.type&&(n.name===(null===(a=t.table.file)||void 0===a?void 0:a.name)||n.size===(null===(i=t.table.file)||void 0===i?void 0:i.size)||n.lastModified===(null===(r=t.table.file)||void 0===r?void 0:r.lastModified));s||l({type:o.J.GRID_UPDATE,payload:{data:[],colDef:[]}});let u=[];void 0!==e.raIndex&&e.raIndex>=0&&u.push(e.raIndex),void 0!==e.decIndex&&e.decIndex>=0&&u.push(e.decIndex),l({type:o.J.USER_FILE_INPUT,payload:{type:"local",columns:e.columns,selectedColumnsId:u,raIndex:e.raIndex,decIndex:e.decIndex,raCol:e.raCol,decCol:e.decCol,dataTypes:e.dataTypes,state:e.positionFound?"success":"positionNotFound",file:n,isSameFile:s}}),l({type:o.J.PLOT_SETUP,payload:{filterIndex:[],filterView:void 0,inspectSelected:!1}}),(0,c.f0)("load_file_local",{category:"load",label:"local",userId:d.S})}}).catch(e=>{console.log(e),l({type:o.J.USER_FILE_INPUT,payload:{type:"local",columns:[],selectedColumnsId:[],raIndex:-1,decIndex:-1,raCol:void 0,decCol:void 0,dataTypes:void 0,state:"error",file:void 0}})})}},[t,l]);return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(v.A,{direction:"row",sx:{alignItems:"center"},children:[(0,a.jsx)(h,{filename:null===(e=t.table.file)||void 0===e?void 0:e.name,onChange:p,inputRef:u,width:400}),(0,a.jsxs)(n.A,{title:"Local Upload",className:"ms-1",children:["Load a table available in local computer. The only required columns are ",(0,a.jsx)("code",{children:"RA"})," and ",(0,a.jsx)("code",{children:"DEC"})," in degrees.",(0,a.jsx)("br",{}),(0,a.jsx)("u",{children:"Available formars"}),": ",(0,a.jsx)("code",{children:"CSV"}),", ",(0,a.jsx)("code",{children:"TSV"}),","," ",(0,a.jsx)("code",{children:"DAT"}),", ",(0,a.jsx)("code",{children:"PARQUET"}),"."]})]})})}let b=new(l(74486)).A,y={on:(e,t)=>b.on(e,t),once:(e,t)=>b.once(e,t),off:(e,t)=>b.off(e,t),emit:(e,t)=>b.emit(e,t),count:e=>b.listenerCount(e)};Object.freeze(y);var I=l(2625),g=l(18799),j=l(77596);function C(){let{tcState:e,tcDispatch:t}=(0,i.c4)(),l=(0,r.useCallback)(function(l){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(l.length>0&&(0,I.Ks)(l)){var n;t({type:o.J.USER_FILE_INPUT,payload:{state:"loading"}}),null===(n=(0,s.E)(l))||void 0===n||n.getTableSummary().then(n=>{if(void 0!=n){let i="remote"===e.table.type&&l==e.table.url;i||t({type:o.J.GRID_UPDATE,payload:{data:[],colDef:[]}});let r=[];void 0!==n.raIndex&&n.raIndex>=0&&r.push(n.raIndex),void 0!==n.decIndex&&n.decIndex>=0&&r.push(n.decIndex),t({type:o.J.USER_FILE_INPUT,payload:{type:"remote",columns:n.columns,selectedColumnsId:r,raIndex:n.raIndex,decIndex:n.decIndex,raCol:n.raCol,decCol:n.decCol,dataTypes:n.dataTypes,state:n.positionFound?"success":"positionNotFound",url:l,isSameFile:i}}),t({type:o.J.PLOT_SETUP,payload:{filterIndex:[],filterView:void 0,inspectSelected:!1}}),a&&t({type:o.J.CURRENT_VIEW_CHANGE,payload:"grid"}),(0,c.f0)("load_file_remote",{category:"load",label:"remote",userId:d.S})}}).catch(e=>{console.log(e),t({type:o.J.USER_FILE_INPUT,payload:{type:"remote",columns:[],selectedColumnsId:[],raIndex:-1,decIndex:-1,raCol:void 0,decCol:void 0,dataTypes:void 0,state:"error",file:void 0}})})}},[t,e]);(0,r.useEffect)(()=>{y.on("INSERT_URL",e=>l(e.url,!0)),(0,c.f0)("load_file_example",{category:"load",label:"example",userId:d.S})},[l]);let p=(0,r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),l(e.target.url.value)},[l]);return(0,a.jsx)(g.A,{component:"form",onSubmit:p,children:(0,a.jsxs)(v.A,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[(0,a.jsx)(j.A,{label:"URL",name:"url",variant:"outlined",sx:{width:"55ch"},defaultValue:e.table.url||""}),(0,a.jsx)(u.A,{type:"submit",variant:"contained",children:"Fetch"}),(0,a.jsxs)(n.A,{title:"Remote Upload",children:["Loads a table available remotely in the internet.",(0,a.jsx)("br",{}),(0,a.jsx)("u",{children:"Available formars"}),": ",(0,a.jsx)("code",{children:"CSV"}),", ",(0,a.jsx)("code",{children:"TSV"}),", \xa0",(0,a.jsx)("code",{children:"DAT"}),", ",(0,a.jsx)("code",{children:"PARQUET"}),"."]})]})})}var A=l(89536),E=l(76547),T=l(81779),F=l(5941),U=l(41452),w=l(62878),S=l(24760),_=l(14573),L=l(48443),P=l(9149),R=l.n(P),N=l(61183),D=l.n(N),O=l(88516),J=l(38658),k=l(3840);function V(e){let t,{label:l,options:n,value:i,onChange:o,getOptionLabel:r=e=>e,isInvalid:s,isValid:d,invalidMessage:c,validMessage:u,defaultMessage:p,sx:m,...x}=e;return s&&c?t=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(J.A,{sx:{fontSize:12,mr:.5},color:"error"}),c]}):d&&u?t=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.A,{sx:{fontSize:12,mr:.5},color:"success"}),u]}):p&&(t=p),(0,a.jsx)(L.A,{disablePortal:!0,sx:{width:300,...m||{}},value:i,onChange:o,options:n,getOptionLabel:r,renderInput:e=>(0,a.jsx)(j.A,{...e,label:l,error:s,helperText:t,slotProps:{input:{...e.InputProps,startAdornment:(0,a.jsxs)(a.Fragment,{children:[s&&(0,a.jsx)(O.A,{position:"start",children:(0,a.jsx)(J.A,{color:"error"})}),d&&(0,a.jsx)(O.A,{position:"start",children:(0,a.jsx)(k.A,{color:"success"})})]})}}}),renderOption:(e,t,l)=>{let{inputValue:n}=l,{key:i,...o}=e,s=r(t),d=D()(s,n,{insideWords:!0}),c=R()(s,d);return(0,a.jsx)("li",{...o,children:(0,a.jsx)("div",{children:c.map((e,t)=>(0,a.jsx)("span",{style:{fontWeight:e.highlight?700:400},children:e.text},t))})},i)},...x})}var M=l(43658),z=l(76424),B=l(33779),G=l(88055),H=l.n(G),q=l(67438),Y=l(90635);function K(){var e,t;let{tcState:l,tcDispatch:n}=(0,i.c4)();return(0,a.jsxs)(v.A,{direction:"row",spacing:1,sx:{alignItems:"basline"},children:[(0,a.jsx)(V,{label:"RA",isInvalid:void 0==l.table.raIndex||l.table.raIndex<0,isValid:void 0!==l.table.raIndex&&l.table.raIndex>=0,value:{index:l.table.raIndex,label:void 0!=l.table.raIndex&&(null===(e=l.table.columns)||void 0===e?void 0:e[l.table.raIndex])||""},onChange:(e,t)=>{let a=null==t?void 0:t.index;if(null==a)n({type:o.J.USER_FILE_INPUT,payload:{raIndex:-1,raCol:void 0,selectedColumnsId:l.table.selectedColumnsId,state:l.table.state}});else{var i;let e=[...l.table.selectedColumnsId];void 0!=l.table.raIndex&&e.includes(l.table.raIndex)&&(e=e.filter(e=>e!=l.table.raIndex)),e.includes(a)||e.push(a),n({type:o.J.USER_FILE_INPUT,payload:{raIndex:a,raCol:null===(i=l.table.columns)||void 0===i?void 0:i[t],selectedColumnsId:e}})}},invalidMessage:"RA column not found",getOptionLabel:e=>e.label,getOptionKey:e=>e.index,options:l.table.columns.map((e,t)=>({label:e,index:t}))}),(0,a.jsx)(V,{label:"DEC",isInvalid:void 0==l.table.decIndex||l.table.decIndex<0,isValid:void 0!==l.table.decIndex&&l.table.decIndex>=0,value:{index:l.table.decIndex,label:void 0!=l.table.decIndex&&(null===(t=l.table.columns)||void 0===t?void 0:t[l.table.decIndex])||""},onChange:(e,t)=>{let a=null==t?void 0:t.index;if(null==a)n({type:o.J.USER_FILE_INPUT,payload:{decIndex:-1,decCol:void 0,selectedColumnsId:l.table.selectedColumnsId,state:l.table.state}});else{var i;let e=[...l.table.selectedColumnsId];void 0!=l.table.decIndex&&e.includes(l.table.decIndex)&&(e=e.filter(e=>e!=l.table.decIndex)),e.includes(a)||e.push(a),n({type:o.J.USER_FILE_INPUT,payload:{decIndex:a,decCol:null===(i=l.table.columns)||void 0===i?void 0:i[a],selectedColumnsId:e}})}},invalidMessage:"DEC column not found",getOptionLabel:e=>e.label,getOptionKey:e=>e.index,options:l.table.columns.map((e,t)=>({label:e,index:t}))})]})}let W=()=>{let{tcState:e,tcDispatch:t}=(0,i.c4)();return(0,a.jsxs)(v.A,{direction:"row",sx:{alignItems:"center"},children:[(0,a.jsx)(A.A,{children:(0,a.jsxs)(F.A,{row:!0,"aria-labelledby":"file-input-source-label",name:"file-input-source-group",value:e.table.type,onChange:e=>{t({type:o.J.USER_FILE_INPUT,payload:{type:e.target.value}})},children:[(0,a.jsx)(E.A,{value:"local",control:(0,a.jsx)(T.A,{}),label:"Local"}),(0,a.jsx)(E.A,{value:"remote",control:(0,a.jsx)(T.A,{}),label:"Remote",sx:{pl:3}})]})}),(0,a.jsxs)(n.A,{title:"Upload Type",children:["Select upload type based on where the source table is stored.",(0,a.jsx)("br",{}),(0,a.jsxs)("ul",{children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:"Local: "})," Table stored in local computer",(0,a.jsx)("br",{})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:"Remote: "})," Table available in internet"]})]})]})]})};function Q(){let{tcState:e}=(0,i.c4)(),t=(0,z.useRouter)(),{tcDispatch:l}=(0,i.c4)(),n="error"==e.table.state,d="positionNotFound"==e.table.state&&(void 0==e.table.raIndex||e.table.raIndex<0||void 0==e.table.decIndex||e.table.decIndex<0);e.table.columns&&e.table.columns.length;let c=(0,r.useCallback)(async()=>{var a,n;let i;if(l({type:o.J.USER_FILE_INPUT,payload:{state:"loading"}}),"local"===e.table.type&&e.table.file)i=await (null===(a=(0,s.E)(e.table.file))||void 0===a?void 0:a.read());else{if("remote"!==e.table.type||!e.table.url)return;i=await (null===(n=(0,s.E)(e.table.url))||void 0===n?void 0:n.read())}let{colDef:r,initVal:d}=B.A.getColDefs(e);i=null==i?void 0:i.map((e,t,l)=>({...e,...d,"ai:id":String(t+1)})),l({type:o.J.GRID_UPDATE,payload:{data:i,colDef:r,isLoaded:!0,currColConfigs:H()(e.cols),currTable:{...e.table},api:void 0}}),l({type:o.J.PLOT_SETUP,payload:{inspectSelected:!1,filterIndex:[],filterView:void 0}}),t.push("/table")},[e,t]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(U.A,{activeStep:0,orientation:"vertical",nonLinear:!0,children:[(0,a.jsxs)(w.A,{expanded:!0,active:!0,children:[(0,a.jsx)(S.A,{optional:void 0,error:!1,children:"Source type"}),(0,a.jsx)(_.A,{TransitionProps:{unmountOnExit:!1},children:(0,a.jsx)(W,{})})]}),(0,a.jsxs)(w.A,{expanded:!0,active:!0,children:[(0,a.jsx)(S.A,{optional:void 0,error:n,children:"Upload file"}),(0,a.jsxs)(_.A,{TransitionProps:{unmountOnExit:!1},children:[(0,a.jsx)("div",{className:"remote"==e.table.type?"d-none":"",children:(0,a.jsx)(f,{})}),(0,a.jsx)("div",{className:"local"==e.table.type?"d-none":"",children:(0,a.jsx)(C,{})})]})]}),(0,a.jsxs)(w.A,{expanded:!n,active:!n&&"unloaded"!==e.table.state&&"loading"!==e.table.state,children:[(0,a.jsx)(S.A,{optional:d&&(0,a.jsx)(m.A,{variant:"caption",color:"error",children:"Can not detect coordinates columns automatically, please select the RA and DEC columns manually"}),error:d,children:"Configure coordinates"}),(0,a.jsx)(_.A,{TransitionProps:{unmountOnExit:!1},children:(0,a.jsx)("div",{className:"unloaded"==e.table.state?"d-none":"",children:(0,a.jsx)(K,{})})})]}),(0,a.jsxs)(w.A,{expanded:!d,active:!n&&!d&&"unloaded"!==e.table.state&&"loading"!==e.table.state,children:[(0,a.jsx)(S.A,{children:"Select columns"}),(0,a.jsx)(_.A,{TransitionProps:{unmountOnExit:!1},children:!d&&(0,a.jsx)(M.A,{})})]})]}),(0,a.jsx)(g.A,{sx:{display:"flex",width:"100%",justifyContent:"center",mt:3},children:(0,a.jsx)(q.A,{loading:"loading"==e.table.state,loadingPosition:"start",disabled:n||d||"unloaded"==e.table.state,variant:"contained",size:"large",startIcon:(0,a.jsx)(Y.A,{}),onClick:c,children:"Load table"})})]})}},36175:(e,t,l)=>{"use strict";l.d(t,{E:()=>p});var a=l(44809),n=l.n(a),i=l(2625);class o{getHeaderSummary(e){let t=(0,i.SL)("ra",e),l=(0,i.SL)("dec",e),a=null==e?void 0:e[t],n=null==e?void 0:e[l];return{raIndex:t,decIndex:l,raCol:a,decCol:n,columns:e,positionFound:t>-1&&l>-1}}async getTableSummary(){let e=await this.getColumns(),t=await this.getDataTypes();return e?{...this.getHeaderSummary(e),dataTypes:t}:void 0}}class r extends o{readFromFile(){return new Promise((e,t)=>{n().parse(this.file,{complete:t=>{let{data:l}=t;return e(l)},error:e=>t(e),delimitersToGuess:[",","	"," ","|",";",n().RECORD_SEP,n().UNIT_SEP],skipEmptyLines:!0,header:!0,dynamicTyping:!0,transformHeader:(e,t)=>"tab:".concat(e)})})}readFromUrl(){return new Promise((e,t)=>{n().parse(this.file,{complete:t=>{let{data:l}=t;return e(l)},error:e=>t(e),skipEmptyLines:!0,header:!0,dynamicTyping:!0,download:!0,transformHeader:(e,t)=>"tab:".concat(e)})})}read(){return"string"==typeof this.file||this.file instanceof String?this.readFromUrl():this.readFromFile()}getColumnsFromFile(){return new Promise((e,t)=>{n().parse(this.file,{complete:l=>{var a;if(l.errors.length>0)return t(l.errors);e(null===(a=l.data)||void 0===a?void 0:a[0])},preview:1})})}getColumnsFromUrl(){return new Promise((e,t)=>{n().parse(this.file,{complete:l=>{var a;if(l.errors.length>0)return t(l.errors);e(null===(a=l.data)||void 0===a?void 0:a[0])},preview:1,download:!0})})}getColumns(){return"string"==typeof this.file||this.file instanceof String?this.getColumnsFromUrl():this.getColumnsFromFile()}getDataTypes(){}constructor(e){super(),this.file=e}}var s=l(73392),d=l(64512);let c={BOOLEAN:"boolean",INT32:"number",INT64:void 0,INT96:void 0,FLOAT:"number",DOUBLE:"number",STRING:"text",BYTE_ARRAY:"object",FIXED_LEN_BYTE_ARRAY:"object",DEFAULT:void 0};class u extends o{readFromFile(){return new Promise((e,t)=>{(async()=>{await (0,s.bA)({file:await this.file.arrayBuffer(),onComplete:t=>e(t),compressors:d.V})})().catch(e=>t(e))})}readFromUrl(){return new Promise((e,t)=>{(async()=>{await (0,s.bA)({file:await (0,s.S1)({url:this.file}),onComplete:t=>e(t),compressors:d.V})})().catch(e=>t(e))})}async read(){let e;e="string"==typeof this.file||this.file instanceof String?await this.readFromUrl():await this.readFromFile();let t=await this.getColumns();return t?e.map(e=>Object.fromEntries(Object.entries(e).map(e=>{let[l,a]=e;return["tab:".concat(t[l]),a]}))):e}async getMetaFromFile(){return void 0===this.meta&&(this.meta=(0,s.m5)(await this.file.arrayBuffer())),this.meta}async getMetaFromUrl(){return void 0===this.meta&&(this.meta=await (0,s.Ei)(await (0,s.S1)({url:this.file}))),this.meta}async getColumnsFromFile(){return(await this.getMetaFromFile()).schema.filter(e=>"schema"!==e.name).map(e=>e.name)}async getColumnsFromUrl(){return(await this.getMetaFromUrl()).schema.filter(e=>"schema"!==e.name).map(e=>e.name)}async getColumns(){return void 0===this.columns&&("string"==typeof this.file||this.file instanceof String?this.columns=await this.getColumnsFromUrl():this.columns=await this.getColumnsFromFile()),this.columns}async getDataTypesFromFile(){return(await this.getMetaFromFile()).schema.filter(e=>"schema"!==e.name).map(e=>{var t,l,a;return c[(null===(l=e.logical_type)||void 0===l?void 0:null===(t=l.type)||void 0===t?void 0:t.toUpperCase())||(null===(a=e.type)||void 0===a?void 0:a.toUpperCase())||"DEFAULT"]})}async getDataTypesFromUrl(){return(await this.getMetaFromUrl()).schema.filter(e=>"schema"!==e.name).map(e=>{var t,l,a;return c[(null===(l=e.logical_type)||void 0===l?void 0:null===(t=l.type)||void 0===t?void 0:t.toUpperCase())||(null===(a=e.type)||void 0===a?void 0:a.toUpperCase())||"DEFAULT"]})}getDataTypes(){return"string"==typeof this.file||this.file instanceof String?this.getDataTypesFromUrl():this.getDataTypesFromFile()}constructor(e){super(),this.file=e,this.columns=void 0,this.meta=void 0}}function p(e){var t,l;let a="string"==typeof e||e instanceof String?null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase():null===(l=e.name.split(".").pop())||void 0===l?void 0:l.toLowerCase();return["csv","tsv","dat","txt"].includes(a||"")?new r(e):["parquet","parq","par","pq"].includes(a||"")?new u(e):void 0}}}]);