"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[837],{45837:(e,l,t)=>{t.d(l,{A:()=>X});var a=t(74848),n=t(22761),d=t(67888),o=t(87707),i=t(96540),s=t(2348),r=t(52177),c=t(41169),x=t(60686),u=t(23445),p=t(59202),b=t(67105);function v(e){let{filename:l,width:t,inputRef:n,onChange:d,sx:o}=e,[s,r]=(0,i.useState)(void 0);l=l||s;let c=(0,i.useRef)(null);return n||(n=c),(0,a.jsxs)(u.A,{variant:"outlined",className:"cursor-pointer",onClick:()=>{var e;null===(e=n.current)||void 0===e||e.click()},sx:{width:t,px:2,py:1.5,display:"flex",flexDirection:"row",borderColor:"action.disabled",justifyContent:"space-between",alignItems:"center",...o},children:[(0,a.jsx)("input",{hidden:!0,type:"file",ref:n,style:{display:"none"},onChange:e=>{var l;r(null===(l=e.target.files)||void 0===l?void 0:l[0].name),d(e)}}),(0,a.jsx)(p.A,{sx:{textOverflow:"ellipsis"},children:l||(0,a.jsx)("i",{children:"No file selected"})}),(0,a.jsx)(x.A,{startIcon:(0,a.jsx)(b.A,{}),variant:"contained",children:"Upload"})]})}var I=t(13210);function h(){var e;let{tcState:l,tcDispatch:t}=(0,d.c4)(),x=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(l.table.file&&x.current){let e=new DataTransfer;e.items.add(l.table.file);let t=e.files;x.current.files=t}},[l.table.file]);let u=(0,i.useCallback)(e=>{if(e.target.files.length>0){var a;let n=e.target.files[0];t({type:o.J.USER_FILE_INPUT,payload:{state:"loading"}}),null===(a=(0,s.E)(n))||void 0===a||a.getTableSummary().then(e=>{if(console.log("summary",e),void 0!==e){var a,d,i;let s="local"===l.table.type&&(n.name===(null===(a=l.table.file)||void 0===a?void 0:a.name)||n.size===(null===(d=l.table.file)||void 0===d?void 0:d.size)||n.lastModified===(null===(i=l.table.file)||void 0===i?void 0:i.lastModified));s||t({type:o.J.GRID_UPDATE,payload:{data:[],colDef:[]}});let x=[];void 0!==e.raIndex&&e.raIndex>=0&&x.push(e.raIndex),void 0!==e.decIndex&&e.decIndex>=0&&x.push(e.decIndex),t({type:o.J.USER_FILE_INPUT,payload:{type:"local",columns:e.columns,selectedColumnsId:x,raIndex:e.raIndex,decIndex:e.decIndex,raCol:e.raCol,decCol:e.decCol,dataTypes:e.dataTypes,state:e.positionFound?"success":"positionNotFound",file:n,isSameFile:s}}),t({type:o.J.PLOT_SETUP,payload:{filterIndex:[],filterView:void 0,inspectSelected:!1}}),(0,c.f0)("load_file_local",{category:"load",label:"local",userId:r.S})}}).catch(e=>{console.log(e),t({type:o.J.USER_FILE_INPUT,payload:{type:"local",columns:[],selectedColumnsId:[],raIndex:-1,decIndex:-1,raCol:void 0,decCol:void 0,dataTypes:void 0,state:"error",file:void 0}})})}},[l,t]);return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(I.A,{direction:"row",sx:{alignItems:"center"},children:[(0,a.jsx)(v,{filename:null===(e=l.table.file)||void 0===e?void 0:e.name,onChange:u,inputRef:x,width:400}),(0,a.jsxs)(n.A,{title:"Local Upload",className:"ms-1",children:["Load a table available in local computer. The only required columns are ",(0,a.jsx)("code",{children:"RA"})," and ",(0,a.jsx)("code",{children:"DEC"})," in degrees.",(0,a.jsx)("br",{}),(0,a.jsx)("u",{children:"Available formars"}),": ",(0,a.jsx)("code",{children:"CSV"}),", ",(0,a.jsx)("code",{children:"TSV"}),","," ",(0,a.jsx)("code",{children:"DAT"}),", ",(0,a.jsx)("code",{children:"PARQUET"}),"."]})]})})}let m=new(t(74486)).A,f={on:(e,l)=>m.on(e,l),once:(e,l)=>m.once(e,l),off:(e,l)=>m.off(e,l),emit:(e,l)=>m.emit(e,l),count:e=>m.listenerCount(e)};Object.freeze(f);var j=t(2625),y=t(18799),A=t(77596);function g(){let{tcState:e,tcDispatch:l}=(0,d.c4)(),t=(0,i.useCallback)(function(t){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.length>0&&(0,j.Ks)(t)){var n;l({type:o.J.USER_FILE_INPUT,payload:{state:"loading"}}),null===(n=(0,s.E)(t))||void 0===n||n.getTableSummary().then(n=>{if(void 0!=n){let d="remote"===e.table.type&&t==e.table.url;d||l({type:o.J.GRID_UPDATE,payload:{data:[],colDef:[]}});let i=[];void 0!==n.raIndex&&n.raIndex>=0&&i.push(n.raIndex),void 0!==n.decIndex&&n.decIndex>=0&&i.push(n.decIndex),l({type:o.J.USER_FILE_INPUT,payload:{type:"remote",columns:n.columns,selectedColumnsId:i,raIndex:n.raIndex,decIndex:n.decIndex,raCol:n.raCol,decCol:n.decCol,dataTypes:n.dataTypes,state:n.positionFound?"success":"positionNotFound",url:t,isSameFile:d}}),l({type:o.J.PLOT_SETUP,payload:{filterIndex:[],filterView:void 0,inspectSelected:!1}}),a&&l({type:o.J.CURRENT_VIEW_CHANGE,payload:"grid"}),(0,c.f0)("load_file_remote",{category:"load",label:"remote",userId:r.S})}}).catch(e=>{console.log(e),l({type:o.J.USER_FILE_INPUT,payload:{type:"remote",columns:[],selectedColumnsId:[],raIndex:-1,decIndex:-1,raCol:void 0,decCol:void 0,dataTypes:void 0,state:"error",file:void 0}})})}},[l,e]);(0,i.useEffect)(()=>{f.on("INSERT_URL",e=>t(e.url,!0)),(0,c.f0)("load_file_example",{category:"load",label:"example",userId:r.S})},[t]);let u=(0,i.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),t(e.target.url.value)},[t]);return(0,a.jsx)(y.A,{component:"form",onSubmit:u,children:(0,a.jsxs)(I.A,{direction:"row",spacing:1,sx:{alignItems:"center"},children:[(0,a.jsx)(A.A,{label:"URL",name:"url",variant:"outlined",sx:{width:"55ch"},defaultValue:e.table.url||""}),(0,a.jsx)(x.A,{type:"submit",variant:"contained",children:"Fetch"}),(0,a.jsxs)(n.A,{title:"Remote Upload",children:["Loads a table available remotely in the internet.",(0,a.jsx)("br",{}),(0,a.jsx)("u",{children:"Available formars"}),": ",(0,a.jsx)("code",{children:"CSV"}),", ",(0,a.jsx)("code",{children:"TSV"}),", \xa0",(0,a.jsx)("code",{children:"DAT"}),", ",(0,a.jsx)("code",{children:"PARQUET"}),"."]})]})})}var C=t(89536),E=t(76547),T=t(81779),_=t(5941),U=t(41452),S=t(62878),R=t(24760),P=t(14573),L=t(48443),N=t(9149),F=t.n(N),w=t(61183),D=t.n(w),J=t(88516),O=t(38658),k=t(3840);function V(e){let l,{label:t,options:n,value:d,onChange:o,getOptionLabel:i=e=>e,isInvalid:s,isValid:r,invalidMessage:c,validMessage:x,defaultMessage:u,sx:p,...b}=e;return s&&c?l=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.A,{sx:{fontSize:12,mr:.5},color:"error"}),c]}):r&&x?l=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.A,{sx:{fontSize:12,mr:.5},color:"success"}),x]}):u&&(l=u),(0,a.jsx)(L.A,{disablePortal:!0,sx:{width:300,...p||{}},value:d,onChange:o,options:n,getOptionLabel:i,renderInput:e=>(0,a.jsx)(A.A,{...e,label:t,error:s,helperText:l,slotProps:{input:{...e.InputProps,startAdornment:(0,a.jsxs)(a.Fragment,{children:[s&&(0,a.jsx)(J.A,{position:"start",children:(0,a.jsx)(O.A,{color:"error"})}),r&&(0,a.jsx)(J.A,{position:"start",children:(0,a.jsx)(k.A,{color:"success"})})]})}}}),renderOption:(e,l,t)=>{let{inputValue:n}=t,{key:d,...o}=e,s=i(l),r=D()(s,n,{insideWords:!0}),c=F()(s,r);return(0,a.jsx)("li",{...o,children:(0,a.jsx)("div",{children:c.map((e,l)=>(0,a.jsx)("span",{style:{fontWeight:e.highlight?700:400},children:e.text},l))})},d)},...b})}var z=t(43658),G=t(76424),M=t(33779),K=t(88055),W=t.n(K),Q=t(67438),q=t(90635);function H(){var e,l;let{tcState:t,tcDispatch:n}=(0,d.c4)();return(0,a.jsxs)(I.A,{direction:"row",spacing:1,sx:{alignItems:"basline"},children:[(0,a.jsx)(V,{label:"RA",isInvalid:void 0==t.table.raIndex||t.table.raIndex<0,isValid:void 0!==t.table.raIndex&&t.table.raIndex>=0,value:{index:t.table.raIndex,label:void 0!=t.table.raIndex&&(null===(e=t.table.columns)||void 0===e?void 0:e[t.table.raIndex])||""},onChange:(e,l)=>{let a=null==l?void 0:l.index;if(null==a)n({type:o.J.USER_FILE_INPUT,payload:{raIndex:-1,raCol:void 0,selectedColumnsId:t.table.selectedColumnsId,state:t.table.state}});else{var d;let e=[...t.table.selectedColumnsId];void 0!=t.table.raIndex&&e.includes(t.table.raIndex)&&(e=e.filter(e=>e!=t.table.raIndex)),e.includes(a)||e.push(a),n({type:o.J.USER_FILE_INPUT,payload:{raIndex:a,raCol:null===(d=t.table.columns)||void 0===d?void 0:d[l],selectedColumnsId:e}})}},invalidMessage:"RA column not found",getOptionLabel:e=>e.label,getOptionKey:e=>e.index,options:t.table.columns.map((e,l)=>({label:e,index:l}))}),(0,a.jsx)(V,{label:"DEC",isInvalid:void 0==t.table.decIndex||t.table.decIndex<0,isValid:void 0!==t.table.decIndex&&t.table.decIndex>=0,value:{index:t.table.decIndex,label:void 0!=t.table.decIndex&&(null===(l=t.table.columns)||void 0===l?void 0:l[t.table.decIndex])||""},onChange:(e,l)=>{let a=null==l?void 0:l.index;if(null==a)n({type:o.J.USER_FILE_INPUT,payload:{decIndex:-1,decCol:void 0,selectedColumnsId:t.table.selectedColumnsId,state:t.table.state}});else{var d;let e=[...t.table.selectedColumnsId];void 0!=t.table.decIndex&&e.includes(t.table.decIndex)&&(e=e.filter(e=>e!=t.table.decIndex)),e.includes(a)||e.push(a),n({type:o.J.USER_FILE_INPUT,payload:{decIndex:a,decCol:null===(d=t.table.columns)||void 0===d?void 0:d[a],selectedColumnsId:e}})}},invalidMessage:"DEC column not found",getOptionLabel:e=>e.label,getOptionKey:e=>e.index,options:t.table.columns.map((e,l)=>({label:e,index:l}))})]})}let B=()=>{let{tcState:e,tcDispatch:l}=(0,d.c4)();return(0,a.jsxs)(I.A,{direction:"row",sx:{alignItems:"center"},children:[(0,a.jsx)(C.A,{children:(0,a.jsxs)(_.A,{row:!0,"aria-labelledby":"file-input-source-label",name:"file-input-source-group",value:e.table.type,onChange:e=>{l({type:o.J.USER_FILE_INPUT,payload:{type:e.target.value}})},children:[(0,a.jsx)(E.A,{value:"local",control:(0,a.jsx)(T.A,{}),label:"Local"}),(0,a.jsx)(E.A,{value:"remote",control:(0,a.jsx)(T.A,{}),label:"Remote",sx:{pl:3}})]})}),(0,a.jsxs)(n.A,{title:"Upload Type",children:["Select upload type based on where the source table is stored.",(0,a.jsx)("br",{}),(0,a.jsxs)("ul",{children:[(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:"Local: "})," Table stored in local computer",(0,a.jsx)("br",{})]}),(0,a.jsxs)("li",{children:[(0,a.jsx)("b",{children:"Remote: "})," Table available in internet"]})]})]})]})};function X(){let{tcState:e}=(0,d.c4)(),l=(0,G.useRouter)(),{tcDispatch:t}=(0,d.c4)(),n="error"==e.table.state,r="positionNotFound"==e.table.state&&(void 0==e.table.raIndex||e.table.raIndex<0||void 0==e.table.decIndex||e.table.decIndex<0);e.table.columns&&e.table.columns.length;let c=(0,i.useCallback)(async()=>{var a,n;let d;if(t({type:o.J.USER_FILE_INPUT,payload:{state:"loading"}}),"local"===e.table.type&&e.table.file)d=await (null===(a=(0,s.E)(e.table.file))||void 0===a?void 0:a.read());else{if("remote"!==e.table.type||!e.table.url)return;d=await (null===(n=(0,s.E)(e.table.url))||void 0===n?void 0:n.read())}let{colDef:i,initVal:r}=M.A.getColDefs(e);d=null==d?void 0:d.map((e,l,t)=>({...e,...r,"ai:id":String(l+1)})),t({type:o.J.GRID_UPDATE,payload:{data:d,colDef:i,isLoaded:!0,currColConfigs:W()(e.cols),currTable:{...e.table},api:void 0}}),t({type:o.J.PLOT_SETUP,payload:{inspectSelected:!1,filterIndex:[],filterView:void 0}}),l.push("/table")},[e,l]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(U.A,{activeStep:0,orientation:"vertical",nonLinear:!0,children:[(0,a.jsxs)(S.A,{expanded:!0,active:!0,children:[(0,a.jsx)(R.A,{optional:void 0,error:!1,children:"Source type"}),(0,a.jsx)(P.A,{TransitionProps:{unmountOnExit:!1},children:(0,a.jsx)(B,{})})]}),(0,a.jsxs)(S.A,{expanded:!0,active:!0,children:[(0,a.jsx)(R.A,{optional:void 0,error:n,children:"Upload file"}),(0,a.jsxs)(P.A,{TransitionProps:{unmountOnExit:!1},children:[(0,a.jsx)("div",{className:"remote"==e.table.type?"d-none":"",children:(0,a.jsx)(h,{})}),(0,a.jsx)("div",{className:"local"==e.table.type?"d-none":"",children:(0,a.jsx)(g,{})})]})]}),(0,a.jsxs)(S.A,{expanded:!n,active:!n&&"unloaded"!==e.table.state&&"loading"!==e.table.state,children:[(0,a.jsx)(R.A,{optional:r&&(0,a.jsx)(p.A,{variant:"caption",color:"error",children:"Can not detect coordinates columns automatically, please select the RA and DEC columns manually"}),error:r,children:"Configure coordinates"}),(0,a.jsx)(P.A,{TransitionProps:{unmountOnExit:!1},children:(0,a.jsx)("div",{className:"unloaded"==e.table.state?"d-none":"",children:(0,a.jsx)(H,{})})})]}),(0,a.jsxs)(S.A,{expanded:!r,active:!n&&!r&&"unloaded"!==e.table.state&&"loading"!==e.table.state,children:[(0,a.jsx)(R.A,{children:"Select columns"}),(0,a.jsx)(P.A,{TransitionProps:{unmountOnExit:!1},children:!r&&(0,a.jsx)(z.A,{})})]})]}),(0,a.jsx)(y.A,{sx:{display:"flex",width:"100%",justifyContent:"center",mt:3},children:(0,a.jsx)(Q.A,{loading:"loading"==e.table.state,loadingPosition:"start",disabled:n||r||"unloaded"==e.table.state,variant:"contained",size:"large",startIcon:(0,a.jsx)(q.A,{}),onClick:c,children:"Load table"})})]})}}}]);